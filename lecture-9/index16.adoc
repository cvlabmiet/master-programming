== Дизайн паттерны

=== Легковес

* https://www.boost.org/libs/flyweight[boost/flyweight.hpp]
* Применяется там, где нужно сохранять повторяющиеся значения в полях объекта
* Использует контейнеры с уникальным ключом для хранения объектов
* Разделение по типам, либо можно задать свой тэг
* Дополнительные шаблонные параметры в типе легковеса
** `set_factory` использовать `std::set` для хранения объектов, а не хешированный массив
** `no_locking` не использовать примитивы синхронизации а-ля мьютексы
** `no_tracking` не отслеживать время жизни объект
*** По умолчанию объект умирает, когда все ссылки на него прекращаются

<<<

[source,cpp]
----
include::example16-1.cpp[]
----

.Output
----
sys::[{outdir}/example16-1]
----

=== Signals2

* https://www.boost.org/libs/signals2[boost/signals2.hpp]
* Концепция сигналов и слотов или событийный паттерн
* Сигналы чем-то напоминают `std::function`
* `connect` позволяет подсоединять свои функции к определённому сигналу (слоты)
** `disconnect` обратное действие
** `num_slots` позволяет узнать, сколько обработчиков подписано на этот сигнал
** Сигнатура обработчика записывается в сигнатуре сигнала
* Можно получить возвращаемое значение последнего обработчика через `operator*`
** Есть возможность задать компоновщика возвращаемых значений, он принимает InputIterator
* `boost::signals2::shared_connection_block` используется для временного прекращения работы слота

<<<

[source,cpp]
----
include::example16-2.cpp[]
----

.Output
----
sys::[{outdir}/example16-2]
----

=== Машина состояний

* https://www.boost.org/libs/msm[boost/msm/]
* 3 фронтэнда (basic, функциональный и eUML) и 1 бекэнд
* Машина состояний строится из состояний, событий, атрибутов событий (действий), гардов
* FSM (Finite State Machine) задаётся с помощью таблицы переходов
* Для взаимодействия сущностей машины состояний служит _таблица переходов_
* Есть вспомогательные макросы для описания всех частей FSM
* У MSM есть методы
** `current_state` для получения текущего состояния
** `process_event` для переключения состояния
** функция `fsm_` для получения доступа к внутренним атрибутам
* Класс `boost::msm::front::state<>` служит для полного определения состояний
* Класс `boost::msm::front::state_machine` позволяет определять машину состояний
* Вспомогательные макросы для сокращения кода

<<<

[source,cpp]
----
include::example16-3.cpp[]
----

.Output
----
sys::[{outdir}/example16-3]
----
