<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru-RU" xml:lang="ru-RU">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Игорь Шаронов" />
  <meta name="date" content="2018-12-17" />
  <title>Master Programming</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" data-external="1"/>
  <style type="text/css">
      .reveal h1 { font-size: 2em; }
      .reveal h2 { font-size: 2em; }
      .reveal h3 { font-size: 1em; }
      .reveal pre code { max-height: 600px; }
      div.column33 {display: inline-block; vertical-align: top; width: 32%;}
      div.column66 {display: inline-block; vertical-align: top; width: 66%;}
      div.column50 {display: inline-block; vertical-align: top; width: 45%;}
      .strike {text-decoration: line-through;}
      table, th, td {
          border: 1px solid black;
      }
  </style>
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript" data-external="1"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Master programming</h1>
  <p class="subtitle">Лекция №12 (Пример проекта на C++)</p>
  <p class="author">
Игорь Шаронов
  </p>
  <p class="date">2018-12-17</p>
</div>
<div id="составляющие-проекта" class="title-slide slide section level1">
<h1>Составляющие проекта</h1>

</div>
<div id="описание" class="slide section level2">
<h1>Описание</h1>
</div>
<div id="структура-проекта" class="slide section level2">
<h1>Структура проекта</h1>
<pre><code>[21:36] igor@nixos-pc imgproc (lecture-12 *) [nix-shell] % tree -I build
.
├── CMakeLists.txt
├── imgproc-config.cmake.in
├── imgproc-version.hpp.in
├── include
│   └── imgproc.hpp
├── README.rst
├── shell.nix
├── src
│   └── main.cpp
└── tests
    ├── CMakeLists.txt
    ├── imgproc.cpp
    └── main.cpp

3 directories, 10 files</code></pre>
</div>
<div id="пример-запуска" class="slide section level2">
<h1>Пример запуска</h1>
<pre><code>[21:35] igor@nixos-pc build (lecture-12 *) [nix-shell] ✗ (255) % ./imgproc -h
An image processing example. Version 0.1.0
Usage:
  ./imgproc [OPTION...] input images

  -h, --help        show help
  -v, --version     show version
  -t, --transform   use transform matrix
  -s, --histogram   create histogram of an image
  -o, --output arg  output image (default: /dev/null)

[21:35] igor@nixos-pc build (lecture-12 *) [nix-shell] % ./imgproc --version
Version 0.1.0</code></pre>
</div>
<div id="необходимые-для-сборки-программы-и-библиотеки" class="slide section level2">
<h1>Необходимые для сборки программы и библиотеки</h1>
<pre><code>[20:19] igor@nixos-pc imgproc (lecture-12 *) % cat shell.nix
with import &lt;nixpkgs&gt; {};
let
  cxxopts = stdenv.mkDerivation rec {
    name = &quot;cxxopts&quot;;
    version = &quot;2.1.1&quot;;
    src = fetchFromGitHub {
      owner = &quot;jarro2783&quot;;
      repo = name;
      rev = &quot;v${version}&quot;;
      sha256 = &quot;1l0bm0ysqa7j7kqhfi4mk6k4rhh5xc6mx82lw468sccn8m8a4ppg&quot;;
    };
    buildInputs = [ cmake ];
  };

in mkShell rec {
  name = &quot;imgproc&quot;;
  buildInputs = [ boost168 libpng libjpeg cxxopts catch2 ];
  nativeBuildInputs = [ cmake gnumake clang_7 gdb valgrind strace cpplint include-what-you-use dpkg ];
  hardeningDisable = [ &quot;all&quot; ];
}</code></pre>
</div>

<div id="сборка-и-тестирование-проекта" class="title-slide slide section level1">
<h1>Сборка и тестирование проекта</h1>

</div>
<div id="дополнительные-опции-сборки" class="slide section level2">
<h1>Дополнительные опции сборки</h1>
<pre><code>[22:19] igor@nixos-pc build (lecture-12 *) [nix-shell] % CXX=clang++ cmake -DCMAKE_CXX_CPPLINT=`which cpplint` -DCMAKE_CXX_INCLUDE_WHAT_YOU_USE=`which include-what-you-use` ..
-- The CXX compiler identification is Clang 7.0.0
-- Check for working CXX compiler: /nix/store/z7fadhim7jrdz5fbqqssbsk50bl3iv2x-clang-wrapper-7.0.0/bin/clang++
-- Check for working CXX compiler: /nix/store/z7fadhim7jrdz5fbqqssbsk50bl3iv2x-clang-wrapper-7.0.0/bin/clang++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Boost version: 1.68.0
-- Found ZLIB: /nix/store/ma27f3n6h01ppxbl6h1igdywhvy4cmr1-zlib-1.2.11/lib/libz.so (found version &quot;1.2.11&quot;)
-- Found PNG: /nix/store/f3l96d1br38kdlif8b5031wc6lal3n38-libpng-apng-1.6.35/lib/libpng.so (found version &quot;1.6.35&quot;)
-- Found JPEG: /nix/store/65qgn465rkrryscfpf2b0mypdchzzj8z-libjpeg-turbo-2.0.1/lib/libjpeg.so (found version &quot;62&quot;)
-- Configuring done
-- Generating done
-- Build files have been written to: /home/igor/master-programming/lecture-12/imgproc/build
[22:19] igor@nixos-pc build (lecture-12 *) [nix-shell] % make
Scanning dependencies of target imgproc_exe
[ 20%] Building CXX object CMakeFiles/imgproc_exe.dir/main.cpp.o
Warning: include-what-you-use reported diagnostics:
/home/igor/master-programming/lecture-12/imgproc/main.cpp:1:10: fatal error: &#39;iostream&#39; file not found
#include &lt;iostream&gt;
         ^~~~~~~~~~

/home/igor/master-programming/lecture-12/imgproc/main.cpp should add these lines:
#include &lt;boost/gil/extension/dynamic_image/../../utilities.hpp&gt;  // for gil

/home/igor/master-programming/lecture-12/imgproc/main.cpp should remove these lines:
- #include &lt;boost/gil/extension/io/png.hpp&gt;  // lines 5-5
- #include &quot;imgproc.hpp&quot;  // lines 8-8

The full include-list for /home/igor/master-programming/lecture-12/imgproc/main.cpp:
#include &lt;boost/gil/extension/dynamic_image/../../utilities.hpp&gt;  // for gil
#include &lt;cxxopts.hpp&gt;                                            // for Opt...
---

Warning: cpplint diagnostics:
/home/igor/master-programming/lecture-12/imgproc/main.cpp:0:  No copyright message found.  You should have a line: &quot;Copyright [year] &lt;Copyright Owner&gt;&quot;  [legal/copyright] [5]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:11:  { should almost always be at the end of the previous line  [whitespace/braces] [4]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:21:  Lines should be &lt;= 80 characters long  [whitespace/line_length] [2]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:27:  { should almost always be at the end of the previous line  [whitespace/braces] [4]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:33:  { should almost always be at the end of the previous line  [whitespace/braces] [4]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:44:  { should almost always be at the end of the previous line  [whitespace/braces] [4]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:46:  Lines should be &lt;= 80 characters long  [whitespace/line_length] [2]
/home/igor/master-programming/lecture-12/imgproc/main.cpp:48:  An else should appear on the same line as the preceding }  [whitespace/newline] [4]</code></pre>
</div>
<div id="способы-тестирования" class="slide section level2">
<h1>Способы тестирования</h1>
<pre><code>[21:44] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ctest -T test
   Site: nixos-pc
   Build name: Linux-clang++
Create new tag: 20181219-1844 - Experimental
Test project /home/igor/master-programming/lecture-12/imgproc/build
    Start 1: imgproc::histogram
1/5 Test #1: imgproc::histogram ...............   Passed    0.00 sec
    Start 2: imgproc::bar
2/5 Test #2: imgproc::bar .....................   Passed    0.00 sec
    Start 3: imgproc::transform
3/5 Test #3: imgproc::transform ...............   Passed    0.00 sec
    Start 4: test_help
4/5 Test #4: test_help ........................   Passed    0.00 sec
    Start 5: test_no_args
5/5 Test #5: test_no_args .....................   Passed    0.00 sec

100% tests passed, 0 tests failed out of 5

Total Test time (real) =   0.01 sec</code></pre>
<pre><code>[21:47] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ctest -T memcheck
   Site: nixos-pc
   Build name: Linux-clang++
Memory check project /home/igor/master-programming/lecture-12/imgproc/build
    Start 1: imgproc::histogram
1/5 MemCheck #1: imgproc::histogram ...............   Passed    0.89 sec
    Start 2: imgproc::bar
2/5 MemCheck #2: imgproc::bar .....................   Passed    0.90 sec
    Start 3: imgproc::transform
3/5 MemCheck #3: imgproc::transform ...............   Passed    0.89 sec
    Start 4: test_help
4/5 MemCheck #4: test_help ........................   Passed    0.79 sec
    Start 5: test_no_args
5/5 MemCheck #5: test_no_args .....................   Passed    0.75 sec

100% tests passed, 0 tests failed out of 5

Total Test time (real) =   4.21 sec
-- Processing memory checking output:
1/5 MemCheck: #1: imgproc::histogram ...............   Defects: 1
2/5 MemCheck: #2: imgproc::bar .....................   Defects: 1
3/5 MemCheck: #3: imgproc::transform ...............   Defects: 1
4/5 MemCheck: #4: test_help ........................   Defects: 1
5/5 MemCheck: #5: test_no_args .....................   Defects: 1
MemCheck log files can be found here: ( * corresponds to test number)
/home/igor/master-programming/lecture-12/imgproc/build/Testing/Temporary/MemoryChecker.*.log
Memory checking results:
Potential Memory Leak - 5</code></pre>
<pre><code>[22:03] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ctest -T memcheck
   Site: nixos-pc
   Build name: Linux-g++
Create new tag: 20181219-1903 - Experimental
Memory check project /home/igor/master-programming/lecture-12/imgproc/build
    Start 1: imgproc::histogram
1/5 MemCheck #1: imgproc::histogram ...............   Passed    1.23 sec
    Start 2: imgproc::bar
2/5 MemCheck #2: imgproc::bar .....................   Passed    1.22 sec
    Start 3: imgproc::transform
3/5 MemCheck #3: imgproc::transform ...............   Passed    1.19 sec
    Start 4: test_help
4/5 MemCheck #4: test_help ........................   Passed    1.02 sec
    Start 5: test_no_args
5/5 MemCheck #5: test_no_args .....................   Passed    0.97 sec

100% tests passed, 0 tests failed out of 5

Total Test time (real) =   5.64 sec
-- Processing memory checking output:
MemCheck log files can be found here: ( * corresponds to test number)
/home/igor/master-programming/lecture-12/imgproc/build/Testing/Temporary/MemoryChecker.*.log
Memory checking results:</code></pre>
<pre><code>[22:12] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ctest -T coverage
   Site: nixos-pc
   Build name: Linux-g++
Performing coverage
   Processing coverage (each . represents one file):
    ...
   Accumulating results (each . represents one file):
    ...............................................
        Covered LOC:         92
        Not covered LOC:     18
        Total LOC:           110
        Percentage Coverage: 83.64%</code></pre>
</div>
<div id="где-найти-полные-логи-результатов-тестов" class="slide section level2">
<h1>Где найти полные логи результатов тестов</h1>
<pre><code>[22:15] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ls Testing/
20181219-1903  CoverageInfo  TAG  Temporary
[22:15] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ls Testing/Temporary/
CTestCostData.txt               LastDynamicAnalysis_20181219-1903.log  MemoryChecker.1.log  MemoryChecker.3.log  MemoryChecker.5.log
LastCoverage_20181219-1903.log  LastTest_20181219-1903.log             MemoryChecker.2.log  MemoryChecker.4.log
[22:15] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ls Testing/20181219-1903/
CoverageLog-0.xml  Coverage.xml  DynamicAnalysis.xml  Test.xml
[22:15] igor@nixos-pc build (lecture-12 *+) [nix-shell] % ls Testing/CoverageInfo/
imgproc.cpp.gcda##affine.hpp.gcov                    main.cpp.gcda##iterator_from_2d.hpp.gcov
imgproc.cpp.gcda##allocator.h.gcov                   main.cpp.gcda##lambda_functors.hpp.gcov
imgproc.cpp.gcda##alloc_traits.h.gcov                main.cpp.gcda##limits.gcov
imgproc.cpp.gcda##basic_string.h.gcov                main.cpp.gcda##locale_classes.tcc.gcov
imgproc.cpp.gcda##basic_string.tcc.gcov              main.cpp.gcda##locale_facets.h.gcov
imgproc.cpp.gcda##catch.hpp.gcov                     main.cpp.gcda##locator.hpp.gcov
imgproc.cpp.gcda##char_traits.h.gcov                 main.cpp.gcda##main.cpp.gcov
imgproc.cpp.gcda##cpp_type_traits.h.gcov             main.cpp.gcda##make_reader.hpp.gcov
imgproc.cpp.gcda##imgproc.cpp.gcov                   main.cpp.gcda##make_writer.hpp.gcov
imgproc.cpp.gcda##imgproc.hpp.gcov                   main.cpp.gcda##move.h.gcov
imgproc.cpp.gcda##initializer_list.gcov              main.cpp.gcda##new_allocator.h.gcov
imgproc.cpp.gcda##lambda_functors.hpp.gcov           main.cpp.gcda##new.gcov
imgproc.cpp.gcda##limits.gcov                        main.cpp.gcda##path_spec.hpp.gcov
imgproc.cpp.gcda##move.h.gcov                        main.cpp.gcda##pixel.hpp.gcov
imgproc.cpp.gcda##new_allocator.h.gcov               main.cpp.gcda##pixel_iterator.hpp.gcov
imgproc.cpp.gcda##new.gcov                           main.cpp.gcda##predefined_ops.h.gcov
imgproc.cpp.gcda##ptr_traits.h.gcov                  main.cpp.gcda##ptr_traits.h.gcov
imgproc.cpp.gcda##range_access.h.gcov                main.cpp.gcda##random.h.gcov
imgproc.cpp.gcda##stl_algobase.h.gcov                main.cpp.gcda##random.tcc.gcov
...</code></pre>
</div>
<div id="сборка-установочного-пакета" class="slide section level2">
<h1>Сборка установочного пакета</h1>
<pre><code>[23:11] igor@nixos-pc build (lecture-12 *) [nix-shell] % CXX=clang++ cmake -DCPACK_GENERATOR=DEB ..
-- The CXX compiler identification is Clang 7.0.0
-- Check for working CXX compiler: /nix/store/z7fadhim7jrdz5fbqqssbsk50bl3iv2x-clang-wrapper-7.0.0/bin/clang++
-- Check for working CXX compiler: /nix/store/z7fadhim7jrdz5fbqqssbsk50bl3iv2x-clang-wrapper-7.0.0/bin/clang++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Boost version: 1.68.0
-- Found ZLIB: /nix/store/ma27f3n6h01ppxbl6h1igdywhvy4cmr1-zlib-1.2.11/lib/libz.so (found version &quot;1.2.11&quot;)
-- Found PNG: /nix/store/f3l96d1br38kdlif8b5031wc6lal3n38-libpng-apng-1.6.35/lib/libpng.so (found version &quot;1.6.35&quot;)
-- Found JPEG: /nix/store/65qgn465rkrryscfpf2b0mypdchzzj8z-libjpeg-turbo-2.0.1/lib/libjpeg.so (found version &quot;62&quot;)
-- Configuring done
-- Generating done
-- Build files have been written to: /home/igor/master-programming/lecture-12/imgproc/build</code></pre>
<pre><code>[23:12] igor@nixos-pc build (lecture-12 *) [nix-shell] % make -j package
Scanning dependencies of target imgproc_exe
Scanning dependencies of target imgproc_test
[ 20%] Building CXX object tests/CMakeFiles/imgproc_test.dir/main.cpp.o
[ 40%] Building CXX object tests/CMakeFiles/imgproc_test.dir/imgproc.cpp.o
[ 60%] Building CXX object CMakeFiles/imgproc_exe.dir/main.cpp.o
[ 80%] Linking CXX executable imgproc_test
[100%] Linking CXX executable imgproc
[100%] Built target imgproc_test
[100%] Built target imgproc_exe
Run CPack packaging tool...
CPack: Create package using DEB
CPack: Install projects
CPack: - Run preinstall target for: imgproc
CPack: - Install project: imgproc
CPack: Create package
CPack: - package: /home/igor/master-programming/lecture-12/imgproc/build/imgproc-0.1.0-Linux-x86_64.deb generated.
CPack: Create package using TGZ
CPack: Install projects
CPack: - Run preinstall target for: imgproc
CPack: - Install project: imgproc
CPack: Create package
CPack: - package: /home/igor/master-programming/lecture-12/imgproc/build/imgproc-0.1.0-Linux-x86_64.tar.gz generated.</code></pre>
<pre><code>[23:19] igor@nixos-pc build (lecture-12 *) [nix-shell] % tar tf /home/igor/master-programming/lecture-12/imgproc/build/imgproc-0.1.0-Linux-x86_64.tar.gz
imgproc-0.1.0-Linux-x86_64/bin/
imgproc-0.1.0-Linux-x86_64/bin/imgproc
imgproc-0.1.0-Linux-x86_64/share/
imgproc-0.1.0-Linux-x86_64/share/doc/
imgproc-0.1.0-Linux-x86_64/share/doc/imgproc/
imgproc-0.1.0-Linux-x86_64/share/doc/imgproc/CMakeLists.txt
imgproc-0.1.0-Linux-x86_64/share/doc/imgproc/imgproc.cpp
imgproc-0.1.0-Linux-x86_64/share/doc/imgproc/main.cpp
imgproc-0.1.0-Linux-x86_64/share/cmake/
imgproc-0.1.0-Linux-x86_64/share/cmake/imgproc/
imgproc-0.1.0-Linux-x86_64/share/cmake/imgproc/imgproc-targets.cmake
imgproc-0.1.0-Linux-x86_64/share/cmake/imgproc/imgproc-targets-noconfig.cmake
imgproc-0.1.0-Linux-x86_64/share/cmake/imgproc/imgproc-config.cmake
imgproc-0.1.0-Linux-x86_64/share/cmake/imgproc/imgproc-config-version.cmake
imgproc-0.1.0-Linux-x86_64/include/
imgproc-0.1.0-Linux-x86_64/include/imgproc.hpp</code></pre>
</div>
</body>
</html>
